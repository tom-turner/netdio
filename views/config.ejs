<div class="hidden h-screen w-full bg-black opacity-80 absolute spinner text-white">

	<span class="flex flex-col space-y-4">

		<p class="text-center mt-10"> Configuration received</p>

		<svg class="w-10 mx-auto animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
			<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
			<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
		</svg>

	</span>

</div>

<div class="flex items-center justify-center h-screen blue flex flex-col p-4 space-y-2">

	<div id="settings" class="w-full max-w-xs bg-white rounded shadow-lg flex px-4 py-2 flex-col ">
		<span class="flex flex-col space-y-2">

			<span class="flex flex-row space-x-2 my-auto hidden">
				<label class="w-1/5" >Name:</label>
				<input id="unitName" class="font-bold w-full" type="text" value="<%= config.rx.name %>">
			</span>

			<span class="flex flex-row -space-x-2 my-auto justify-between">
				<lable class="w-1/5">DHCP:</lable>
				<div id="dhcp" class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
					<input id="toggle" type="checkbox" name="toggle" class="absolute block w-6 h-6 rounded-full bg-white border-2 appearance-none cursor-pointer transform transition duration-500 translate-x-4"/>
					<span id="toggle-bg" class="toggle-label block overflow-hidden h-6 rounded-full bg-blue-100 cursor-pointer transition duration-500 blue"></span>
				</div>
				
			</span>
	

			<span id="ipDisplay" class="flex flex-row w-full justify-between">
				<lable >IP Address:</lable>
				<p><%= config.device.ip %></p>
			</span>
			<form id="staticForm" class="hidden space-y-2">
				<input id="static" type="checkbox" hidden>
				<span class="flex flex-row space-x-2 justify-between ">
					<label>IP Address:</label>
					<input id="ipAddress" type="text" name="ip" class="text-right" placeholder="10.10.0.100" value="<%= config.device.ip %>">
				</span>
				<span class="flex flex-row space-x-2 justify-between ">
					<label>Subnet: </label>
					<input id="subnet" type="text" name="subnet" class="text-right" placeholder="255.255.255.0" value="<%= config.device.subnet %>">
				</span>

				<span class="flex flex-row space-x-2 justify-between">
					<label>Router: </label>
					<input id="router" type="text" name="router" class="text-right" placeholder="10.10.0.1" value="<%= config.device.router %>">
				</span>
			</form>



			<button id="configure" class="button border px-2 rounded-full text-white blue">Configure</button>
			<button id="blink" class="button border px-2 rounded-full text-white blue">Blink</button>
			
			<button id="restart" class="button border px-2 rounded-full text-grey-400 bg-white">Restart</button>
		</span>
	</div>
</div>

<div class="hidden flex items-center justify-center h-screen bg-blue-100">


</div>




<script type="text/javascript">

	var socket = io();

	function loading(isLoading) {
		if (isLoading) {
			document.querySelector(".button").disabled = true;
			document.querySelector(".spinner").classList.remove("hidden");

		} else {
			document.querySelector(".button").disabled = false;
			document.querySelector(".spinner").classList.add("hidden");
		}
	}


	// listens for new config
	socket.on("newConfig", (config) => {
		loading(true)
		setTimeout(function(){
			window.location.href = "http://" + config + ":5000"
		}, 2000);
	})



	$('#unitName').on("input" , () => {
		var message = {
			type: 'name', 
			value: $('#unitName').val()
		}
		socket.emit('setConfig', message)	
	})

	$('#dhcp').on("click" , function(){
		$('#toggle').toggleClass("translate-x-4")
		$('#toggle-bg').toggleClass("blue")
		$('#staticForm').toggleClass("hidden")
		$('#ipDisplay').toggleClass("hidden")
	})

	$('#blink').on("click" , function(){
		
		var message = {
			ip : '<%= config.device.ip %>',
			type : 'blink'
		}

		socket.emit('forward', message)
	})

	$('#configure').on("click" , function() {
		loading(true)
		var message = {
			type : 'ip',
			value : $('#ipAddress').val()
		}
		socket.emit("config", message)
	})

	$('#restart').on("click" , function() {
		socket.emit("restart")
		loading(true)
	})


</script>