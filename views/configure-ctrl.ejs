
<div class="hidden h-screen w-full bg-black opacity-80 absolute spinner text-white">

	<span class="flex flex-col space-y-4">

		<p class="text-center mt-10"> Configuration received</p>

		<svg class="w-10 mx-auto animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
			<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
			<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
		</svg>

	</span>

</div>


<div class="flex items-center justify-center h-screen bg-blue-800 bg-opacity-30 flex flex-col p-4 space-y-2">

<div class="w-full bg-white rounded shadow-lg flex  p-2 px-4 flex-col">
	<div class="justify-between flex w-full">
		<p>Settings:</p>
		<img id="settings-gear" class="w-6 cursor-pointer transform" onclick="toggleSettings('settings','settings-gear')" src="./public/images/gear.svg"/>
	</div>

	<div id="settings" class="w-full hidden">
		<span class="flex flex-col space-y-2">
			<label>Name:</label>
			<input id="unitName" class="border rounded" type="text">
			<label>IP Address:</label>
			<input id="ipAddress" class="border rounded" type="text">
			<button id="configure" class="button border px-2 rounded text-white bg-blue-600">Configure</button>
			<button id="restart" class="button border px-2 rounded text-grey-400 bg-white">Restart</button>
		</span>
	</div>

</div>

<div class="w-full bg-white rounded shadow-lg flex  p-2 px-4 flex-col">
	<div class="justify-between flex w-full">
		<p>Devices:</p>
		<img id="routing-gear" class="w-6 cursor-pointer transform" onclick="toggleSettings('routing','routing-gear')" src="./public/images/gear.svg"/>
	</div>
</div>
	<div id="routing" class="flex flex-row h-screen justify-between w-full space-x-2 hidden">

		<div class="flex rounded shadow-lg flex-col p-4 bg-white w-1/2">
			<h2 class="text-center"> Inputs </h2>
			<ul id="inputs" class="border rounded h-full">

			</ul>
			
		</div>


		<div class="flex rounded shadow-lg flex-col p-4 bg-white w-1/2">
			<h2 class="text-center"> Destinations </h2>
			<ul id="destinations" class="border rounded h-full">

			</ul>
		</div>

	</div>

	<div id="zone" class="flex flex-col h-screen w-full bg-white rounded shadow-lg p-2 px-4">
		<div class="justify-between flex w-full">
			<p>Zone Control:</p>
		</div>

		<div class="h-full py-2">
			<ul id="zones" class="border rounded h-full flex flex-col">

			</ul>
		</div>
	</div>

</div>

<script type="text/javascript">

	var socket = io();

	function loading(isLoading) {
		if (isLoading) {
			document.querySelector(".button").disabled = true;
			document.querySelector(".spinner").classList.remove("hidden");

		} else {
			document.querySelector(".button").disabled = false;
			document.querySelector(".spinner").classList.add("hidden");
		}
	}

	function toggleSettings(id, button) {
		document.getElementById(id).classList.toggle("hidden")
		document.getElementById(button).classList.toggle("rotate-90")
	}

	function createZone(device) {
		
		console.log(device)

		return	$(`<li id="'+ device.ip+ '" class="bg-blue-400 bg-opacity-20 hover:bg-opacity-10 border rounded flex flex-col p-2 m-2" onclick="selectInput('${device.ip}')" />`).append(
            		$('<div class="flex flex-col"/>').append(
              			$('<div class"w-full flex flex-row justify-between"/>').append(
              				$('<span class="font-bold" />').text(device.name)
              			),
              			$('<input type="range" class="w-full volume-' + device.ip + '" />')
            		)
        		)
	}

	function createDeviceLi(device) {

		console.log(device)

		return	$('<li id="'+ device.ip + '" class="border rounded flex flex-col md:flex-row px-2 py-1 m-2 justify-between"/>').append(
					$('<div class="flex flex-row space-x-2"/>').append(
						$('<label />').text("Name: "),
						$('<input type="text" class="w-full font-bold name-' + device.name + '" value="' + device.name + '" />')
					),
					$('<div class="flex flex-row space-x-2"/>').append(
						$('<lable/>').text("IP: "),
						$('<input type="text" class="w-full ip-' + device.ip + '" value="' + device.ip + '" />'),
						$('<button class="text-white rounded-full px-2 bg-blue-600 att-' + device.ip +'" />').text("Blink")
					)
				)

	}



	function selectInput(device) {
		console.log("you selected this zone: ", device )
		

	}



	// receives config on page load
	socket.on("config", (config) => {	
		loading(false)
		console.log("config: ", config)
		document.getElementById("ipAddress").value = config.ip;
		document.getElementById("unitName").value = config.name;
	});

	// listens for new config
	socket.on("newConfig", (config) => {
		loading(true)
		setTimeout(function(){
			window.location.href = "http://" + config.ip + ":5000"
		}, 2000);
	})

	// listens for devices
	socket.on("devices", (devices) => {
		console.log("device", devices)

		for (device of devices) {

			if(device.type == 'rx') {
				var zone = createZone(device)
				$('#zones').append(zone)

				var li = createDeviceLi(device)
				$('#destinations').append(li)
			}
		}

	})
	

	$('#configure').on("click" , function() {
		loading(true)
		var config = {
			name : document.getElementById("unitName").value,
			ip : document.getElementById("ipAddress").value
		}
		socket.emit("config", config)
	})

	$('#restart').on("click" , function() {
		socket.emit("restart")
		loading(true)
	})

</script>